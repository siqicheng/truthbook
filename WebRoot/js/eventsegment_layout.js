var items = [
             {
            	 imgsrc: "http://lorempixel.com/319/542/",
            	 descript: "中文显示测试",
            	 meta: "2014-04-15",
            	 uploader: {
            		 		userid:"1", 
            		 		username:"张三", 
            		 		url:"http://localhost:8080/truthbook/profile_test.html"
            		 		},
            	comments: [
            	           {
            	        	   userid: "1",
            	        	   username: "张三",
            	        	   content: "测试长评论暗示法大赛的法师法师的减肥撒哈拉是否会拉的开始发货的萨克雷锋哈伦裤啥地方哈考虑是否还卡了师傅说对啦快递费",
            	        	   url:"http://localhost:8080/truthbook/profile_test.html",
            	        	   meta: "yyyy-mm-dd",
            	        	   avatar: "./img/profile_test/247142.jpg"
            	           },
            	           {
            	        	   userid: "2",
            	        	   username: "李四",
            	        	   content: "图不错！",
            	        	   url:"http://localhost:8080/truthbook/profile_test.html",
            	        	   meta: "yyyy-mm-dd",
            	        	   avatar: "./img/profile_test/247144.jpg"
            	           },
            	           {
            	        	   userid: "1",
            	        	   username: "张三",
            	        	   content: "测试评论",
            	        	   url:"http://localhost:8080/truthbook/profile_test.html",
            	        	   meta: "yyyy-mm-dd",
            	        	   avatar: "./img/profile_test/247142.jpg"
            	           },
            	           {
            	        	   userid: "2",
            	        	   username: "李四",
            	        	   content: "图不错！",
            	        	   url:"http://localhost:8080/truthbook/profile_test.html",
            	        	   meta: "yyyy-mm-dd",
            	        	   avatar: "./img/profile_test/247144.jpg"
            	           },
            	           {
            	        	   userid: "1",
            	        	   username: "张三",
            	        	   content: "测试评论",
            	        	   url:"http://localhost:8080/truthbook/profile_test.html",
            	        	   meta: "yyyy-mm-dd",
            	        	   avatar: "./img/profile_test/247142.jpg"
            	           },
            	           {
            	        	   userid: "2",
            	        	   username: "李四",
            	        	   content: "图不错！",
            	        	   url:"http://localhost:8080/truthbook/profile_test.html",
            	        	   meta: "yyyy-mm-dd",
            	        	   avatar: "./img/profile_test/247144.jpg"
            	           },            	           {
            	        	   userid: "1",
            	        	   username: "张三",
            	        	   content: "测试评论",
            	        	   url:"http://localhost:8080/truthbook/profile_test.html",
            	        	   meta: "yyyy-mm-dd",
            	        	   avatar: "./img/profile_test/247142.jpg"
            	           },
            	           {
            	        	   userid: "2",
            	        	   username: "李四",
            	        	   content: "图不错！",
            	        	   url:"http://localhost:8080/truthbook/profile_test.html",
            	        	   meta: "yyyy-mm-dd",
            	        	   avatar: "./img/profile_test/247144.jpg"
            	           },
            	           {
            	        	   userid: "1",
            	        	   username: "张三",
            	        	   content: "测试评论",
            	        	   url:"http://localhost:8080/truthbook/profile_test.html",
            	        	   meta: "yyyy-mm-dd",
            	        	   avatar: "./img/profile_test/247142.jpg"
            	           },
            	           {
            	        	   userid: "2",
            	        	   username: "李四",
            	        	   content: "图不错！",
            	        	   url:"http://localhost:8080/truthbook/profile_test.html",
            	        	   meta: "yyyy-mm-dd",
            	        	   avatar: "./img/profile_test/247144.jpg"
            	           },
            	           {
            	        	   userid: "1",
            	        	   username: "张三",
            	        	   content: "测试评论",
            	        	   url:"http://localhost:8080/truthbook/profile_test.html",
            	        	   meta: "yyyy-mm-dd",
            	        	   avatar: "./img/profile_test/247142.jpg"
            	           },
            	           {
            	        	   userid: "2",
            	        	   username: "李四",
            	        	   content: "图不错！",
            	        	   url:"http://localhost:8080/truthbook/profile_test.html",
            	        	   meta: "yyyy-mm-dd",
            	        	   avatar: "./img/profile_test/247144.jpg"
            	           },            	           {
            	        	   userid: "1",
            	        	   username: "张三",
            	        	   content: "测试评论",
            	        	   url:"http://localhost:8080/truthbook/profile_test.html",
            	        	   meta: "yyyy-mm-dd",
            	        	   avatar: "./img/profile_test/247142.jpg"
            	           },
            	           {
            	        	   userid: "2",
            	        	   username: "李四",
            	        	   content: "图不错！",
            	        	   url:"http://localhost:8080/truthbook/profile_test.html",
            	        	   meta: "yyyy-mm-dd",
            	        	   avatar: "./img/profile_test/247144.jpg"
            	           },
            	           {
            	        	   userid: "1",
            	        	   username: "张三",
            	        	   content: "测试评论",
            	        	   url:"http://localhost:8080/truthbook/profile_test.html",
            	        	   meta: "yyyy-mm-dd",
            	        	   avatar: "./img/profile_test/247142.jpg"
            	           },
            	           {
            	        	   userid: "2",
            	        	   username: "李四",
            	        	   content: "图不错！",
            	        	   url:"http://localhost:8080/truthbook/profile_test.html",
            	        	   meta: "yyyy-mm-dd",
            	        	   avatar: "./img/profile_test/247144.jpg"
            	           },
            	           {
            	        	   userid: "1",
            	        	   username: "张三",
            	        	   content: "测试评论",
            	        	   url:"http://localhost:8080/truthbook/profile_test.html",
            	        	   meta: "yyyy-mm-dd",
            	        	   avatar: "./img/profile_test/247142.jpg"
            	           },
            	           {
            	        	   userid: "2",
            	        	   username: "李四",
            	        	   content: "图不错！",
            	        	   url:"http://localhost:8080/truthbook/profile_test.html",
            	        	   meta: "yyyy-mm-dd",
            	        	   avatar: "./img/profile_test/247144.jpg"
            	           },            	           {
            	        	   userid: "1",
            	        	   username: "张三",
            	        	   content: "测试评论",
            	        	   url:"http://localhost:8080/truthbook/profile_test.html",
            	        	   meta: "yyyy-mm-dd",
            	        	   avatar: "./img/profile_test/247142.jpg"
            	           },
            	           {
            	        	   userid: "2",
            	        	   username: "李四",
            	        	   content: "图不错！",
            	        	   url:"http://localhost:8080/truthbook/profile_test.html",
            	        	   meta: "yyyy-mm-dd",
            	        	   avatar: "./img/profile_test/247144.jpg"
            	           },
            	           {
            	        	   userid: "1",
            	        	   username: "张三",
            	        	   content: "测试评论",
            	        	   url:"http://localhost:8080/truthbook/profile_test.html",
            	        	   meta: "yyyy-mm-dd",
            	        	   avatar: "./img/profile_test/247142.jpg"
            	           },
            	           {
            	        	   userid: "2",
            	        	   username: "李四",
            	        	   content: "图不错！",
            	        	   url:"http://localhost:8080/truthbook/profile_test.html",
            	        	   meta: "yyyy-mm-dd",
            	        	   avatar: "./img/profile_test/247144.jpg"
            	           },
            	           {
            	        	   userid: "1",
            	        	   username: "张三",
            	        	   content: "测试评论",
            	        	   url:"http://localhost:8080/truthbook/profile_test.html",
            	        	   meta: "yyyy-mm-dd",
            	        	   avatar: "./img/profile_test/247142.jpg"
            	           },
            	           {
            	        	   userid: "2",
            	        	   username: "李四",
            	        	   content: "图不错！",
            	        	   url:"http://localhost:8080/truthbook/profile_test.html",
            	        	   meta: "yyyy-mm-dd",
            	        	   avatar: "./img/profile_test/247144.jpg"
            	           },            	           {
            	        	   userid: "1",
            	        	   username: "张三",
            	        	   content: "测试评论",
            	        	   url:"http://localhost:8080/truthbook/profile_test.html",
            	        	   meta: "yyyy-mm-dd",
            	        	   avatar: "./img/profile_test/247142.jpg"
            	           },
            	           {
            	        	   userid: "2",
            	        	   username: "李四",
            	        	   content: "图不错！",
            	        	   url:"http://localhost:8080/truthbook/profile_test.html",
            	        	   meta: "yyyy-mm-dd",
            	        	   avatar: "./img/profile_test/247144.jpg"
            	           },
            	           {
            	        	   userid: "1",
            	        	   username: "张三",
            	        	   content: "测试评论",
            	        	   url:"http://localhost:8080/truthbook/profile_test.html",
            	        	   meta: "yyyy-mm-dd",
            	        	   avatar: "./img/profile_test/247142.jpg"
            	           },
            	           {
            	        	   userid: "2",
            	        	   username: "李四",
            	        	   content: "图不错！",
            	        	   url:"http://localhost:8080/truthbook/profile_test.html",
            	        	   meta: "yyyy-mm-dd",
            	        	   avatar: "./img/profile_test/247144.jpg"
            	           },
            	           {
            	        	   userid: "1",
            	        	   username: "张三",
            	        	   content: "测试评论",
            	        	   url:"http://localhost:8080/truthbook/profile_test.html",
            	        	   meta: "yyyy-mm-dd",
            	        	   avatar: "./img/profile_test/247142.jpg"
            	           },
            	           {
            	        	   userid: "2",
            	        	   username: "李四",
            	        	   content: "图不错！",
            	        	   url:"http://localhost:8080/truthbook/profile_test.html",
            	        	   meta: "yyyy-mm-dd",
            	        	   avatar: "./img/profile_test/247144.jpg"
            	           },
            	           ],
            	 like_num: 10  	 
              },
              {
            	  imgsrc:"http://lorempixel.com/319/549/",
            	  descript:"这是一张外网的图",
            	  meta:"2014-04-14",
            	  uploader: {
			      		 		userid:"2", 
			    		 		username:"李四", 
			    		 		url:"http://localhost:8080/truthbook/profile_test.html"
    		 				},
            	  comments:[
            	            {
            	            	userid: "1",
             	        	   	username: "张三",
             	        	   	content: "test...",
             	        	   	url:"http://localhost:8080/truthbook/profile_test.html",
             	        	   	meta: "yyyy-mm-dd",
             	        	   	avatar: "./img/profile_test/247142.jpg"
            	            }],
            	  like_num:2            		  
              },
              {
            	  imgsrc:"http://lorempixel.com/319/380/",
            	  descript:"我已经不知道要写些什么了，但是这张照片的描述想要长长长长长长一点",
            	  meta:"2014-04-14",
            	  uploader: {
			      		 		userid:"2", 
			    		 		username:"李四", 
			    		 		url:"http://localhost:8080/truthbook/profile_test.html"
    		 				},
            	  comments:[
            	            {
            	            	userid: "1",
             	        	   	username: "张三",
             	        	   	content: "test...",
             	        	   	url:"http://localhost:8080/truthbook/profile_test.html",
             	        	   	meta: "yyyy-mm-dd",
             	        	   	avatar: "./img/profile_test/247142.jpg"
            	            }],
            	  like_num:3            		  
              },              
              {
            	  imgsrc:"http://echographs.com/wp-content/uploads/2012/06/flame_thrower_740_nologo.gif",
            	  descript:"这是张用echograph拍出来的火焰的图",
            	  meta:"2014-04-15",
            	  uploader: {
			      		 		userid:"2", 
			    		 		username:"李四", 
			    		 		url:"http://localhost:8080/truthbook/profile_test.html"
    		 				},
            	  comments:[
            	            {
            	            	userid: "1",
             	        	   	username: "张三",
             	        	   	content: "test...",
             	        	   	url:"http://localhost:8080/truthbook/profile_test.html",
             	        	   	meta: "yyyy-mm-dd",
             	        	   	avatar: "./img/profile_test/247142.jpg"
            	            }],
            	  like_num:4            		  
              },
              {
            	  imgsrc:"http://lorempixel.com/319/600/",
            	  descript:"Silly dogs can be quite fun to have as companions. You never know what kind of ridiculous thing they will do.",
            	  meta:"yyyy-mm-dd",
            	  uploader: {
			      		 		userid:"2", 
			    		 		username:"李四", 
			    		 		url:"http://localhost:8080/truthbook/profile_test.html"
    		 				},
            	  comments:[
            	            {
            	            	userid: "1",
             	        	   	username: "张三",
             	        	   	content: "test...",
             	        	   	url:"http://localhost:8080/truthbook/profile_test.html",
             	        	   	meta: "yyyy-mm-dd",
             	        	   	avatar: "./img/profile_test/247142.jpg"
            	            }],
            	  like_num:5            		  
              },
              {
            	  imgsrc:"http://media02.hongkiat.com/cinemagraph-iphone-android-apps/echograph.gif",
            	  descript:"Silly dogs can be quite fun to have as companions. You never know what kind of ridiculous thing they will do.",
            	  meta:"yyyy-mm-dd",
            	  uploader: {
			      		 		userid:"2", 
			    		 		username:"李四", 
			    		 		url:"http://localhost:8080/truthbook/profile_test.html"
    		 				},
            	  comments:[
            	            {
            	            	userid: "1",
             	        	   	username: "张三",
             	        	   	content: "test...",
             	        	   	url:"http://localhost:8080/truthbook/profile_test.html",
             	        	   	meta: "yyyy-mm-dd",
             	        	   	avatar: "./img/profile_test/247142.jpg"
            	            }],
            	  like_num:6            		  
              }               
             ];

$(document).ready(function() {
	itemLayout(items);
	$('.testitemload').click(function(){
		$('#eventsegment').masonry('destroy');
		itemLayout(items);
	});
});

function itemLayout(items){
	var newitems = itemCreate(items);
	$('#eventsegment').append(newitems).masonry({		
		itemSelector: '.eventpile',
		gutter: 11});
	itemInitialize();
}


function itemInitialize(){
		//shape flip
	$(".commentToggle").click(function(){		
		$(this).parents('.ui.shape').shape('flip over');
		$('#eventsegment').masonry();		
	});
		
		//After all images have loaded, rerange the masonry item
	$('#eventsegment').imagesLoaded( function() {
		$('#eventsegment').masonry();
	});
		
		//force the mansonry layout run
	$("#eventsegment").mouseover(function(){
		$('#eventsegment').masonry();
	});
		
		
	//buttons on images show on/off
	$("#eventsegment .eventpile .item .image").hover(function(){
		    $(this).children(".imgbtnArea").fadeIn("fast");
		    $(this).children("img").fadeTo("fast",0.9);
				},
				function(){
		    $(this).children(".imgbtnArea").fadeOut("fast");
		    $(this).children("img").fadeTo("fast",1);
			}
		);
	//遍历所有图片元素后为它们加上magnificPopup插件的初始化选项
	$num_items = $("#eventsegment").find(".eventpile .item .image img");
		for(var i=0, len=$num_items.length;i< len;i++){
	  		$($num_items[i]).magnificPopup({
				items: {
 					src:  $($num_items[i]).attr("src")
				},
				type: 'image'
		}); 
		};
	
	// remove the event item
	$(".eventRemove").click(function(){
			eventRemove($(this))
		});
}

//item remove function, input is the object of the remove button
function eventRemove($removeBtn) {
	var rmelement = $removeBtn.parents(".eventpile");
	$("#eventsegment").masonry( 'remove', rmelement);
}

function itemCreate(items) {
	var elems=[];
	for(var i=0, len=items.length;i< len;i++){
		var item = items[i];
		var comment_num = item.comments.length;
		var comment='';
		if (comment_num > 0) {
			for(var j=0;j< comment_num;j++){
				var comment_item = item.comments[j];
				comment += ("\t\t<div class='comment'>\n" +
								"\t\t\t<a class='avatar' href='"+comment_item.url+"'>" +
										"<img src='"+comment_item.avatar+"'></a>\n"+
								"\t\t\t<div class='content'>\n"+
								"\t\t\t\t<a class='author' href='"+comment_item.url+"'>"+comment_item.username+"</a>\n"+
								"\t\t\t\t<div class='metadata'><span class='date'>"+comment_item.meta+"</span></div>\n"+
								"\t\t\t\t<div class='text'>"+comment_item.content+"</div>\n"+
								"\t\t\t</div>\n"+
							"\t\t</div>\n");
			}
		}
		var newItem =
//		$("#eventsegment").append(
				"<div class='eventpile'>\n" +
                    "<div class='ui shape'>\n" +
                    "\t<div class='sides'>\n" +
                    "\t\t<div class='active side ui items'>\n" +
                    "\t\t\t<div class='item'>\n" +
					"\t\t\t<div class='image'>\n"+
						"\t\t\t\t<img src='"+item.imgsrc+"'>\n"+
						"\t\t\t\t<div class='imgbtnArea'>\n" +
						"\t\t\t\t\t<div class='ui tiny button likebtn'><i class='heart tiny icon'></i></div>\n"+
						"\t\t\t\t\t<div class='ui tiny red inverted button commentbtn commentToggle'>\n" +
						"\t\t\t\t\t\t<i class='comment icon'></i>"+comment_num+"</div>\n" +
						"\t\t\t\t</div>\n"+
					"\t\t\t</div>\n"+
					"\t\t\t<div class = 'content'>\n"+
						"\t\t\t\t<p class='description'>"+item.descript+"</p>\n"+
						"\t\t\t\t<div class='meta'>"+"by <a class='uploader' href='"+item.uploader.url+"'>"+
							item.uploader.username+"</a> "+
							item.meta+"</div>\n"+
					"\t\t\t</div>\n"+
					"\t\t\t<div class='btnArea'>\n" +
                    "\t\t\t<div class='ui tiny basic animated button rePost'>\n" +
                    "\t\t\t\t<div class='visible content'><i class='reply mail icon'></i></div>\n" +
                    "\t\t\t\t<div class='hidden content'>返还照片</div>\n" +
                    "\t\t\t</div>\n" +
                    "\t\t\t<div class='ui tiny basic animated button uploadFor'>\n" +
                    "\t\t\t\t<div class='visible content'><i class='cloud upload icon'></i></div>\n" +
                    "\t\t\t\t<div class='hidden content'>为其上传</div>\n" +
                    "\t\t\t</div>\n" +
                    "\t\t\t<div class='ui tiny basic animated button setPortrait'>\n" +
                    "\t\t\t\t<div class='visible content'><i class='smile icon'></i></div>\n" +
                    "\t\t\t\t<div class='hidden content'>设为头像</div>\n" +
                    "\t\t\t</div>\n" +
                    "\t\t\t<div class='ui tiny basic animated button eventRemove'>\n" +
                    "\t\t\t\t<div class='visible content'><i class='remove icon'></i></div>\n" +
                    "\t\t\t\t<div class='hidden content'>删除照片</div>\n" +
                    "\t\t\t</div>\n" +
                    "\t\t\t</div>\n" +
                    "\t\t\t</div>\n" +
                    "\t\t</div>\n" +
					"\t\t<div class='side ui items'>\n" +
                    "\t\t\t<div class='item'>\n" +
                    "\t\t\t<h2 class='ui header'>所有评论</h2>\n" +
					"\t\t\t<div class='ui minimal comments'>\n"+comment+
					"\t\t\t\t<form class='ui reply form'>\n"+
					"\t\t\t\t\t<div class='field'><textarea placeholder='你想说…'></textarea></div>\n"+
					"\t\t\t\t\t<div class='ui small teal button'>添加评论</div>\n"+
					"\t\t\t\t</form>\n"+
					"\t\t\t</div>\n"+
					"\t\t\t<div class='btnArea'>\n" +
                    "\t\t\t<button class='ui tiny basic animated button commentToggle'>\n" +
                    "\t\t\t\t<div class='visible content'>&ensp;<i class='angle left icon'></i>&ensp;</div>\n" +
                    "\t\t\t\t<div class='hidden content'>返回</div>\n" +
                    "\t\t\t</button>\n" +
                    "\t\t\t</div>\n" +
					"\t\t\t</div>\n" +
                    "\t\t</div>\n" +
                    "\t</div>\n" +
                    "</div>\n" +
				"</div>\n";
		elems.push( newItem );
	}
	return elems;
}

