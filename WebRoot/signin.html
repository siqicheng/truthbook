<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>登陆 | 趣事簿</title>

  <link href="./assets/semantic/css/semantic.css" rel="stylesheet">
  <!-- location CSS -->
  <link href="./CSS/position.css" rel="stylesheet">
  <link href="./CSS/signin_up.css" rel="stylesheet">
  <link rel="shortcut icon" href="img/logo_red.ico" />
  <link rel="stylesheet" href="CSS/general.css" type="text/css"></link>

<!--     <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Tangerine"> -->
    <style type="text/css">body {font-family:Tahoma,Verdana,STHeiTi,simsun,sans-serif;}</style>

  <!-- Google Analytics -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-49027267-2', 'truthbook.cc');
    ga('send', 'pageview');
  </script>
</head>

  <script>
    var host = window.location.host;
    if(host == "www.truthbook.cc"){
      window.location.href = "http://truthbook.cc";
    }
  </script>
<body class="body_bg" id="body">

  <div class="absolute-center" id='centerarea'>
    <img src="img/Truthbook_capital.png">
    <!-- login form -->
    <div id='topAlertBar'>
      <div class="ui red  message">
          <p></p>
      </div>
    </div>
    <form class="ui form login-form" >
      <!--email field-->
        <div class="field">
          <div class="ui left labeled icon input">
              <input type="text" id="email" name="email" placeholder="邮箱">
              <i class="user icon"></i>
          </div>
        </div>
        <!--password field-->
        <div class="field">
          <div class="ui left icon input">
              <input type="password" id="password" name="password" placeholder="密码">
              <i class="lock icon"></i>
          </div>
        </div>
        <input class="ui fluid blue button" type ="submit" id="loginBtn" value = "登录">
        <div id="resText"></div>
        <div class="ui error message" id="errorMessageLogin" style="display: none">用户名或密码不正确</div>
    </form>

    <!-- register form, display none in default -->
    <form class="ui form register-form">
                <!-- fullName field -->
                <div class="field" id="fullNameTest">
                    <div class="ui left labeled icon input">
                        <input type="text" id="fullName" placeholder="姓名" name="fullName" onblur="checkButtonValid()">
                        <i class="user icon"></i>
                    </div>
                </div>
                <!-- school field -->
                <div class="field" id="schoolTest">
                    <div class="ui left labeled icon input">
                        <input type="text" id="school" placeholder="学校：复旦大学/上海外国语大学" name="school" onblur="checkButtonValid()">
                        <i class="book icon"></i>
                    </div>
                </div>
                <!-- entryTime field -->
        <div class="field" id="entryTimeTest">
                    <div class="ui left labeled icon input">
                        <input type="text" id="entryTime" placeholder="入学年份：2008/2012/..." name="entryTime" onblur="checkButtonValid()">
                        <i class="align justify icon"></i>
                    </div>
                </div>
                <!-- email field -->
                <div class="field" id="emailTest">
                    <div class="ui left labeled icon input">

                        <input type="text" id="email" name="email"  placeholder="邮箱" onblur="checkEmail(this.value)" >
                        <div class="ui corner label green" id = "cornerlabel" style="display: none">
                      <i class="checkmark small icon" id="correctCheckmark" style="display: none"></i>
                    </div>

                        <span id="txtHint" ></span>
                        <i class="mail icon"></i>
                  </div>
                </div>
                <div class="field">
                  <div class="ui red pointing prompt label transition" id="errorMessageMail" style="display: none;">邮箱已存在，换个小号吧</div>
        </div>
                <!--password field-->
                <div class="field" id="pwTest">
                    <div class="ui left icon input">
                        <input type="password" id="password" name="password"  placeholder="密码" onblur="checkButtonValidPW()">
                        <i class="lock icon"></i>
                    </div>
                </div>
          <input class="ui disabled fluid blue button" type ="submit" id="register_button" value = "注册">
        </form>
  </div>

    <!-- register&login toggle button -->
  <div class="bottom-left">
      <button class="ui basic animated button" id="registerToggle">
          <div class="visible content"> 注册 </div>
          <div class="hidden content">
              <i class="pencil icon"></i>
          </div>
      </button>
      <button class="ui basic animated button" id="loginToggle" style="display:none;">
           <div class="visible content"> 登录 </div>
           <div class="hidden content">
               <i class="sign in icon"></i>
           </div>
       </button>
  </div>

  <div class="ui dimmer page">
	  <div class="ui test modal hidden white-popup" id="rechooseform">        <!-- 重名选人 -->
		    <form class="ui form" id="rechooseform">
<!-- 		      <h3 class="ui header">认领词条</h3> -->
		      <div class="ui two column divided grid">
		          <div class="column">
		            <div class="ui attached message">
		            	<div class="header">
		            		恭喜你被邀请加入趣事簿！
						</div>
						<div class="content">
							输入词条创建人的<b>"姓"</b>来完成词条认领。
						</div>
		            </div>
		            <div class="ui selection list" id="rechooselist"></div>
		            <a class="ui right floated tiny red header" id="newQuote" href="javascript:void(0)" style="text-font:12px"><u>以上都不是</u></a>
		            <div class="ui green bottom attached message" id="tipMessage" style="display:none;">请输入照片上传者的姓完成注册：</div>
		            <div class="ui action input">
		                <input type="text"  id="checkinput" disabled placeholder="请选择">
		                <div class="ui blue button" id="confirmbtn" >确认</div>
		            </div>
		          </div>
		          <div class="middle aligned column">
		              <div style="text-align:center;" class="ui basic segment">
		              	<div class="ui inverted dimmer"> 
		              		<div class="ui loader"></div>
		              	</div>
		                <img style="max-height:300px; max-width:300px;" id="imgPrev"  src="img/Truthbook_red.png">
		              </div>
		        </div>
		      </div>
		    </form>
	  </div>
  </div>

    <div class="ui item dimmable">
      <div class="ui dimmer page hidden">
        <div class="ui basic modal deleteFriend transition hidden" id="testModal" style="margin-top: -159px;">
          <div class="header" id="modalHeader"></div>
          <div class="content">
            <div class="left"style="width: 40%"><i class="home icon" id = "modalLogo"></i></div>
          <div class="right"><p id="modalContent"></p></div>
          </div>
          <div class="actions">
            <div class="ui two fluid buttons">
            <div class="ui negative vertical animated left labeled icon button">
                    <i class="remove icon"></i>
                    <div class="visible content" id="modalNegativeBtn">取消</div>
                    <div class="hidden content" id="modalNegativeBtnHidden"></div>
            </div>
            <div class="ui positive vertical animated right labeled icon button">
                  <div class="visible content" id="modalPositiveBtn">确定</div>
                    <div class="hidden content" id="modalPositiveBtnHidden"></div>
                <i class="checkmark icon"></i>
            </div>
          </div>
          </div>
        </div>
    </div>
  </div>

  <script src="./assets/jquery/jquery-1.7.2.js"></script>
  <script src="./assets/jquery/jquery.cookie.js"></script>
  <script src="./assets/semantic/javascript/semantic.js"></script>
  <script src="./js/general/utility.js"></script>
  <script src="./js/general/globalValue.js"></script>
  <script src="./js/general/language_zh_cn.js"></script>
  <script src="./js/signin_up/form_toggle.js"></script>
  <script src="./js/signin_up/register.js"></script>
  <script src="./js/profilePage/dimmer_modal_popup_Handler.js"></script>
  <script>
    $(function() {
      if($.cookie("truthbook") != undefined) {
        goHomePage();
      }
    });
  </script>
  <script type="text/javascript">
  //login form functions
    $(function() {


//      var host = window.location.host;
//      if(host == "www.truthbook.cc"){
//        localhost = "www.truthbook.cc";
//      }

      //form validation
      $( '.ui.form.login-form' )
        .form({
            email: {
              identifier : 'email',
              rules: [
                {
                  type   : 'empty',
                  prompt : '请输入注册邮箱'
                }
              ]
            },
            password: {
              identifier : 'password',
              rules: [
                {
                  type   : 'empty',
                  prompt : '请输入密码'
                },
                {
                  type   : 'length[6]',
                  prompt : '密码至少要6位'
                }
              ]
            }
        },{//form settings(semantics)
          on: 'blur',
            inline: 'true',
            onInvalid : hideErrorMessageLogin,
        });
        function hideErrorMessageLogin(){
          $("#errorMessageLogin").hide();
                }
      });

      $(function() {

        cookieAvailableCheck();
        //clean all truthbook cookie
//        cleanUserInfoCookie();
      });

    $('.ui.form.login-form')
      .submit(function(){
        var isValidLoginForm = $('.ui.form.login-form').form('validate form');
        if(isValidLoginForm == true){
          var path = "v1/login";
          var url=ServerRoot+ServiceType.LOGIN+path;
//          var url="http://localhost:8080/truthbook/services/loginService/v1/login";
          var data= $('.ui.form.login-form').serialize();
//          var type = typeof(data);
          var onAjaxSuccess = function(data,textStatus){
            if (data == false){
              $("#errorMessageLogin").show();
//              $("#errorMessageLogin").text("Login failed. Please validate your username/password.");
//              console.log("Login failed. Please validate your username/password.");
              return false;

            }
            else{
              $("#errorMessageLogin").hide();
              setUserInfoCookie(data);
              goHomePage();
              return true;
            }
          };
          var onAjaxError = function(xhr,status,error){
            $("#errorMessageLogin").show();
            $("#errorMessageLogin").text("登陆失败:" + error);
            return false;
          };
          var ajax_obj = getAjaxObj(url,"POST","json",onAjaxSuccess,onAjaxError);
          ajax_obj.data = data;
          ajax_call(ajax_obj);
          return false;
        }
      return false;
    });
    $(document).ajaxStart(function(email, password) {
      $("#loginBtn").addClass("loading");
    });
    $(document).ajaxStop(function() {
      $("#loginBtn").removeClass("loading");
    });
    $(document).ajaxError(function() {
      $("#errorMessageLogin").show();
    });
  </script>

</body>
</html>
