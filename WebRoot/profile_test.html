<!DOCTYPE html>
<html lang="en">
<head>
   	<meta charset="utf-8">
   	<title>个人主页 | Truthbook</title>

   	<link href="./assets/semantic/css/semantic.css" rel="stylesheet">
   	<link href="./assets/magnific-popup/magnific-popup.css" rel="stylesheet">
   	<link href="./CSS/position.css" rel="stylesheet">
   	<link href="./CSS/addpicBtn.css" rel="stylesheet">
   	<link href="./CSS/topBar.css" rel="stylesheet">
   	<link href="./CSS/menuBar.css" rel="stylesheet">
   	<link href="./CSS/eventSegment.css" rel="stylesheet">
   	<link href="./CSS/profileSegment.css" rel="stylesheet">
   	<link rel="shortcut icon" href="img/logo_red.ico"/>
</head>

<body style="background-color:#DEDCDE;margin:0px;">

	<div class="ui fixed small menu" id="topbar" >
		<div class="left menu">
			<div class="ui dropdown item" id="upload_menu">
				<i class="add icon"></i> 上传照片（sidebar）
				<div class="menu">
					<a class="item" id="upload_for_new_btn">新建好友档案</a>
					<div class="ui dropdown item" id="upload_for_fri_btn">
						为已有好友上传 <i class="dropdown icon"></i>
						<div class="menu">
							<div class="ui dropdown item">
								极·友<i class="dropdown icon"></i>
								<div class="list menu eFriendsList upload_for_fri">
									<div class="item">
										<div class="content" style="padding-top: 7px;font-size:16px;width:120px">
											你现在还没有极·友哦
										</div>
									</div>
								</div>
							</div>
							<div class="ui dropdown item">
								真·友<i class="dropdown icon"></i>
								<div class="list menu nFriendsList upload_for_fri">
									<div class="item">
										<div class="content" style="padding-top: 7px;font-size:16px;width:120px">
											你现在还没有真·友哦
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
 				</div>
			</div>
			<a class="item" id="close_sidebar_btn" style="display:none">
				<i class="remove icon"></i> 关闭 </a>
		</div>		
		<div class="title item" onclick = "goHomePage();" style="cursor:pointer;">
	        <img src="img/Truthbook_red.png" width="140px" >
	    </div>		      
		<a class="active green item">
			<i class="home  icon"></i>
		</a>
		<a class="blue item">
	    	<i class="users icon"></i>
		</a>
		<a class="orange item">
	    	<i class="setting icon"></i>
		</a>
		<a class="open_popup_link item" href="#upload">上传照片（PopUp）</a>
		
		<div class="right menu">
				<form class="ui form item" onsubmit = "return searchUsers();">
     				<div class="ui icon input">
       				<input type="text" id = "searchFullName" placeholder="Search..." >
       				<i class="search link icon" onclick = "searchUsers();"></i>
     				</div>
   				</form>
   				<div class = "ui animated button icon" id="exitButton"> 
   					<div class="visible content">
					    <i class="off icon"></i>
					</div>
   					<div class="hidden content">
					    <i class="sign out icon"></i>
					</div>
   				</div>
 		</div>
 		
	</div>

	<div id="upload" class="white-popup  mfp-hide">

			<div class="ui steps">
   				<div class="ui active step" id="step1" style="cursor:pointer;">
   					选人
   				</div>
   				<div class="ui disabled step" id="step2">
   					选照片
   				</div>
   				<div class="ui disabled step" id="step3">
   					完成
   				</div>
   			</div>
   			
   			<div class="ui divider"></div>
   			
   			<form class="ui form chooseppform" id="chooseppform" onSubmit="return false;">
   				<div class="field" id="fullNameTest">
                    <label>姓名</label>
                    <div class="ui left labeled icon input">
                        <input type="text" id="fullName" placeholder="姓名" name="fullName">
                        <i class="user icon"></i>
                    </div>
                </div>
   				<div class="field" id="schoolTest">
   					<label>学校</label>
                    <div class="ui left labeled icon input">
                        <input type="text" id="school" placeholder="学校： 复旦大学/北京大学" name="school">
                        <i class="book icon"></i>
                    </div>
                </div>
   				<div class="field" id="entryTimeTest">
   					<label>入学年份</label>
                    <div class="ui left labeled icon input">
                        <input type="text" id="entryTime" placeholder="入学年份： 2008/2012/..." name="entryTime">
                        <i class="align justify icon"></i>
                    </div>
                </div>
                <div class="ui error message"></div>
   				<div class="ui divider"></div>
 					<input class="ui green button nextstep" id="nextstep1"  value="下一步" readonly>
 				</form>
 				
 				<div class="ui form" id="choosepicform" style="display:none">
    			<div class="ui field">
    				<label>照片描述</label>
    				<textarea></textarea>
    			</div>

 					<div class="ui divider"></div>
 					
 					<img id="img_prev" src="" alt="your image" ><br>
 					<div class="addpicbuttons"><a href="javascript:;" class="addpic">
 					<input type ="file" id="fileElem"  onchange="readURL(this);">选择图片</a>
 					<!-- <button class="ui fluid blue button" id="fileSelect">选择文件</button> -->
 					<input class="ui green button nextstep" id="nextstep2"  value="下一步" readonly> </div>
 				</div>
 				
 				<div class="ui form" id="confirmform" style="display:none">
 					<!-- 预览效果 -->
 					<div class="ui message" id="previewmessage"></div>
 					<div class="ui items">
  					<div class="item">
  						<div class="image">
  							<img src="./img/profile_test/247146.jpg">
  						</div>
  						<div class="content">
  							<div class="name">
  								图片预览
  							</div>
  							<p class="description">图片描述</p>
  						</div>
  					</div>
 					</div>
 					<div class="ui divider"></div>
 					<input class="ui green button" id="submitBtn"  value="确定上传" readonly>
 				</div>
 				
 				<div class="ui form" id="rechooseform" style="display:none"> <!-- 重名选人 -->
					<div class="ui attached message" id="rechoosemessage">
					</div>
	 					<div class="ui selection list" id="rechooselist">
					</div>
					<div class="ui red bottom attached message segment"  id="rechooseerror" style="display:none">请选择要发给的对象</div>
					<div class="ui divider"></div>
	 					<input class="ui green button" id="nextstep3" value="下一步"  readonly>
 				</div>
	</div>

	<div id="profile-segment">
		<div class="ui stacked raised segment" style="height:300px;">
<!-- 			<div class="ui circular segment"></div> -->
			<div class="ui three wide column grid">
				  <div class="column">
					  <div class="ui segment">
					    	<span id="testCookie1"></span>
					  </div>
				  </div>
				  <div class="column">
					  <div class="ui segment">
					    	<span id="testCookie"></span>
					  </div>
				  </div>
				  
				  <div class="column">
					  <div class="ui segment" > 
					  	<div class="ui animated list">
							<div id="testSearch">
							</div>
						</div>	
					  </div>
				  </div>
			</div>
		</div>
	</div>

	<div class="ui basic segment" id="menubar" >
		<div class="ui four column grid" >
			<div class="column">
				<div class="ui red inverted fluid menu eFriends" >
					<div class="ui dropdown fluid item" >
						<i class="star small icon"></i> 极·友
						<div class="ui small label" id="eFriends_num">0</div>
						<div class="ui list menu eFriendsList" id="eFriendsList">	
							<div class="item">
								<div class="content" style="padding-top: 7px;font-size:16px;width:120px">
									你现在还没有极·友哦
								</div>
							</div>
     					</div>
   					</div>
				</div>
 			</div>
			<div class="column">
				<div class="ui red inverted fluid menu">
					<div class="ui dropdown fluid item">
						<i class="half empty star small icon"></i> 真·友
						<div class="ui small label" id="nFriends_num" style="float:right">0</div>
						<div class="list menu nFriendsList" id="nFriendsList">
							<div class="item">
								<div class="content" style="padding-top: 7px;font-size:16px;width:120px">
									你现在还没有真·友哦
								</div>
							</div>
   						</div>
   					</div>
				</div>
			</div>
			<div class="column">
				<div class="ui red inverted fluid menu">
					<div class="ui dropdown fluid item">
						<i class="users small icon"></i> 最近来访
						<div class="ui small label" style="float:right">3</div>
						<div class="menu">
     						<a class="item">张三</a>
     						<a class="item">李四</a>
     						<a class="item">王五</a>
   						</div>
   					</div>
				</div>
			</div>
			<div class="column">
				<div class="ui red inverted fluid menu"> 						
					<div class="ui dropdown fluid item">
						<i class="mail small icon"></i> 消息通知
						<div class="floating ui circular green label">05</div>
						<div class="menu">
     						<a class="item">您有一条新的好友请求</a>
     						<a class="item">张三为您上传了一张照片</a>
     						<a class="item">5条新评论</a>
   						</div>
   					</div>
				</div>
			</div>
		</div>
	</div>
	
	<div class="ui three items" id="eventsegment"></div>
	
  <div class="ui basic modal transition hidden" style="margin-top: -159px;">
    <div class="header">
      退出 Truthbook
    </div>
    <div class="content">
      <div class="left">
        <i class="home icon"></i>
      </div>
      <div class="right">
        <p>确定一定以及肯定要下线并且   <b>注销登录</b>   了吗?</p>
      </div>
    </div>
    <div class="actions">
      <div class="two fluid ui buttons">
        <div class="ui negative labeled icon button">
          <i class="remove icon"></i>
          不，我错了
        </div>
        <div class="ui positive right labeled icon button">
          是，谁都别拦着我
          <i class="checkmark icon"></i>
        </div>
      </div>
    </div>
    </div>
    
	<script src="./assets/jquery/jquery-1.7.2.js"></script>
	<script src="./assets/jquery/jquery.cookie.js"></script>
	<script src="./assets/semantic/javascript/semantic.js"></script>
	<script src="./assets/masonry.pkgd.min.js"></script>
	<script src="./assets/imagesloaded.pkgd.min.js"></script>
	<script src="./assets/magnific-popup/magnific-popup.js"></script>
	<script src="./js/general/globalValue.js"></script>
	<script src="./js/general/utility.js"></script>
	<script src="./js/general/globalValue.js"></script>	
	<script src="./js/popup.js"></script>
	<script src="./js/friends.js"></script>
	<script src="./js/uploadpopup.js"></script>
	<script src="./js/sidebar_toggle.js"></script>
	<script src="./js/eventsegment_layout.js"></script>

	<script type="text/javascript">
	$(function() {
		$("#testCookie1").html("Cookie test : OK!");
		$("#testCookie1").append("<br>");
		$("#testCookie").append("<br>");
		$("#testCookie").append("<br>");
		$("#testCookie").append("Email:\t"+tmp.email);
		$("#testCookie").append("<br>");
		$("#testCookie").append("EntryTime:\t"+tmp.entryTime);
		$("#testCookie").append("<br>");
		$("#testCookie").append("FullName:\t"+tmp.fullName);
		$("#testCookie").append("<br>");
		$("#testCookie").append("IsActivated:\t"+tmp.isActivated);
		$("#testCookie").append("<br>");
		$("#testCookie").append("School:\t"+tmp.school);
		$("#testCookie").append("<br>");
		$("#testCookie").append("UserID:\t"+tmp.userId);
		$("#testCookie").append("<br>");
		$("#testCookie").append("PageOwnersUserID:\t"+$.cookie("truthbook_PageOwner_userId"));$("#testCookie").append("<br>");
		printUserNameById($.cookie("truthbook_PageOwner_userId"));
		
		$( "#exitButton" ).click(function() {
			$('.basic.modal')
		   	.modal('setting', {
// 		   		closable: false,
		   		onApprove : function() {
			    	cleanUserInfoCookie();
			    	goLogin();
			    }
		   	})
		   	.modal('show');
		});
	});
	

	
	
function printUserNameById(id){
	if(id != undefined && id != null){
		var path = "v1/" + id;
		var url=ServerRoot+ServiceType.LOGIN+path;
		var onAjaxSuccess = function(data,textStatus){
			if (data != null ){
				$("#testCookie").append("PageOwnersUserName:\t" + data.fullName);$("#testCookie").append("<br>");
				return true;
			}
			else{
				("#testCookie").append("PageOwnersUserName:\t" + data.fullName);$("#testCookie").append("<br>");		
				return true;
			}
		};
		var onAjaxError = function(xhr,status,error){
			return false;
		};
		var ajax_obj = getAjaxObj(url,"GET","json",onAjaxSuccess,onAjaxError);
		ajax_call(ajax_obj);
	}	
	
}	
	
function searchUsers(){
	$("#testSearch").html("");
	userFullName = $("#searchFullName").attr("value"); 
	if (userFullName != null){
		var path = "v1/fullName/";
		var action = "/verify";
		var url=ServerRoot+ServiceType.LOGIN+path + userFullName + action;
		var onAjaxSuccess = function(data,textStatus){
			if (data == null){
				alert(data);
				return false;
			}
			else{		
				length = userLengthJson(data);
// 				alert("length: "+length);
				if (length == 1){
				userId = data.user.userId;
				fullName = data.user.fullName;
				school = data.user.school;
				entryTime = data.user.entryTime;
				email = data.user.email;
				$("#testSearch").append("<div class=\"item\" > <div class=\"content\"> <a class=\"header\" onclick = \"goOthersPage("+ userId + ")\">"+ fullName + "</a> <div class=\"description\">" + school + "\t" + entryTime + "\t" + email + "</div></div></div>");
				
// 					userID = data.user.userId;
// 					goOthersPage(userID);
				} else if (length > 0){
					for(i = 0;i<length;++i){
						userId = data.user[i].userId;
						fullName = data.user[i].fullName;
						school = data.user[i].school;
						entryTime = data.user[i].entryTime;
						email = data.user[i].email;
						$("#testSearch").append("<div class=\"item\" > <div class=\"content\"> <a class=\"header\" onclick = \"goOthersPage("+ userId + ")\">"+ fullName + "</a> <div class=\"description\">" + school + "\t" + entryTime + "\t" + email + "</div></div></div>");
// 						$("#testSearch").append("");
// 						$("#testSearch").append("<a class=\"header\" onclick = \"goOthersPage("+ userId + ")\">"+ fullName + "</a>");
// 						$("#testSearch").append("<div class=\"description\">" + school + "\t" + entryTime + "\t" + email + "</div>");
// 						$("#testSearch").append("</div>");
// 						$("#testSearch").append("</div>");
					}
				}
				return true;
			}
		};
		var onAjaxError = function(xhr,status,error){
			alert("Error: " + error);
			return false;
		};
		var ajax_obj = getAjaxObj(url,"GET","json",onAjaxSuccess,onAjaxError);
		ajax_call(ajax_obj);	
	} else {
		
	}
	return false;
};
	</script>
	
	<script type="text/javascript">
	$(document).ready(function() {
			//semantic dropdown intialization
		$('.ui.dropdown')
 				.dropdown(
 					{on: 'click'
 					}
 				);
	});
	</script>

	<script>
		$(function(){
			$(".open_popup_link").magnificPopup({
				type:"inline",
				midClick: true
			});
		});
	</script>

	<script>
		$(function() {
			$("#upload_for_fri_btn").dropdown( {
				on: "hover"
			});
		});
	</script>

</body>
</html>